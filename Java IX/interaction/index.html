<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interaction - A-Frame Gaze-Based Interactions</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        .info {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 5px;
            z-index: 100;
            max-width: 350px;
        }
        .info h3 {
            margin-top: 0;
            color: #00d4ff;
        }
        .score {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,128,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            z-index: 100;
            font-size: 18px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="info">
        <h3>Ndërveprimimi me Shikim (Gaze-Based)</h3>
        <p><strong>Cursor:</strong> Drejtoni cursor-in (qarkun e kuq) tek objektet</p>
        <p><strong>Fusing:</strong> Mbani shikimin për 2 sekonda për të aktivizuar</p>
        <p><strong>Qëllimi:</strong> Aktivizoni të gjitha objektet me shikim!</p>
    </div>

    <div class="score">
        Rezultati: <span id="scoreValue">0</span>/6
    </div>

    <a-scene background="color: #1a1a2e">
        <a-assets>
            <!-- Audio për efekte -->
            <audio id="clickSound" preload="auto">
                <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBDuZ3fXKdSgELIHR9N2ITggTZLrx6aFOEQxOqObxs2EbBjiS2fDJeBEE" type="audio/wav">
            </audio>
            <audio id="successSound" preload="auto">
                <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBDuZ3fXKdSgELIHR9N2ITggTZLrx6aFOEQxOqObxs2EbBjiS2fDJeBEE" type="audio/wav">
            </audio>

            <!-- Mixins për materiale -->
            <a-mixin id="interactive-object"
                     geometry="primitive: box"
                     material="metalness: 0.3; roughness: 0.4"
                     shadow="cast: true"
                     animation__mouseenter="property: scale; to: 1.1 1.1 1.1; startEvents: mouseenter; dur: 200"
                     animation__mouseleave="property: scale; to: 1 1 1; startEvents: mouseleave; dur: 200">
            </a-mixin>
        </a-assets>

        <!-- Drita -->
        <a-light type="ambient" color="#404040" intensity="0.4"></a-light>
        <a-light type="directional" position="5 5 5" color="#ffffff" intensity="0.8" shadow="cast: true"></a-light>
        <a-light type="point" position="0 4 0" color="#ff6b6b" intensity="0.3"></a-light>

        <!-- Kamera me cursor për gaze-based interaction -->
        <a-camera position="0 1.6 6" look-controls wasd-controls>
            <a-cursor 
                id="cursor"
                position="0 0 -1"
                geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                material="color: #ff6b6b; opacity: 0.8"
                cursor="fuse: true; fuseTimeout: 2000"
                animation__click="property: scale; startEvents: click; from: 0.1 0.1 0.1; to: 1 1 1; dur: 150"
                animation__fusing="property: material.color; startEvents: fusing; from: #ff6b6b; to: #00ff00; dur: 2000"
                animation__fusecomplete="property: material.color; startEvents: mouseleave; to: #ff6b6b; dur: 100">
            </a-cursor>
        </a-camera>

        <!-- Objektet interaktive -->
        
        <!-- Kubi i parë - majtas -->
        <a-entity 
            id="cube1"
            class="interactive"
            mixin="interactive-object"
            position="-3 1.5 0"
            material="color: #ff6b6b"
            data-activated="false">
        </a-entity>

        <!-- Sfera e dytë - qender-majtas -->
        <a-entity 
            id="sphere1"
            class="interactive"
            geometry="primitive: sphere; radius: 0.5"
            material="color: #4ecdc4; metalness: 0.3; roughness: 0.4"
            position="-1 2 -1"
            shadow="cast: true"
            data-activated="false"
            animation__idle="property: rotation; to: 360 360 0; dur: 8000; loop: true; easing: linear">
        </a-entity>

        <!-- Cilindri i tretë - qender-djathtas -->
        <a-entity 
            id="cylinder1"
            class="interactive"
            geometry="primitive: cylinder; height: 1.5; radius: 0.3"
            material="color: #ffe66d; metalness: 0.2; roughness: 0.6"
            position="1 1.75 -0.5"
            shadow="cast: true"
            data-activated="false"
            animation__bounce="property: position; to: 1 2.5 -0.5; dur: 1500; direction: alternate; loop: true; easing: easeInOutQuad">
        </a-entity>

        <!-- Kubi i katërt - djathtas -->
        <a-entity 
            id="cube2"
            class="interactive"
            mixin="interactive-object"
            position="3 1 1"
            material="color: #a8e6cf"
            data-activated="false"
            animation__spin="property: rotation; to: 0 360 0; dur: 4000; loop: true; easing: linear">
        </a-entity>

        <!-- Piramida e pestë - prapa -->
        <a-entity 
            id="pyramid1"
            class="interactive"
            geometry="primitive: cone; height: 1.2; radiusBottom: 0.6"
            material="color: #dda0dd; metalness: 0.4; roughness: 0.3"
            position="0 1.1 -3"
            shadow="cast: true"
            data-activated="false"
            animation__float="property: position; to: 0 2.1 -3; dur: 2000; direction: alternate; loop: true; easing: easeInOutSine">
        </a-entity>

        <!-- Oktahedri i gjashtë - lartë -->
        <a-entity 
            id="octahedron1"
            class="interactive"
            geometry="primitive: octahedron; radius: 0.4"
            material="color: #ffa07a; metalness: 0.5; roughness: 0.2"
            position="0 3.5 0"
            shadow="cast: true"
            data-activated="false"
            animation__complex="property: rotation; to: 360 360 360; dur: 6000; loop: true; easing: linear">
        </a-entity>

        <!-- Plani bazë -->
        <a-plane 
            position="0 0 0" 
            rotation="-90 0 0" 
            width="15" 
            height="15" 
            color="#2c2c54"
            shadow="receive: true"
            material="metalness: 0; roughness: 1">
        </a-plane>

        <!-- Teksti udhëzues -->
        <a-text 
            value="Drejtoni cursor-in tek objektet dhe prisni 2 sekonda" 
            position="0 4 -2" 
            align="center" 
            color="#ffffff" 
            width="8"
            animation__glow="property: material.emissive; to: #333333; dur: 2000; direction: alternate; loop: true">
        </a-text>

        <!-- Indikatori i përparimit -->
        <a-entity id="progressBar" position="0 0.5 -4">
            <a-box position="-2.5 0 0" width="0.5" height="0.2" depth="0.1" color="#333333"></a-box>
            <a-box position="-1.5 0 0" width="0.5" height="0.2" depth="0.1" color="#333333"></a-box>
            <a-box position="-0.5 0 0" width="0.5" height="0.2" depth="0.1" color="#333333"></a-box>
            <a-box position="0.5 0 0" width="0.5" height="0.2" depth="0.1" color="#333333"></a-box>
            <a-box position="1.5 0 0" width="0.5" height="0.2" depth="0.1" color="#333333"></a-box>
            <a-box position="2.5 0 0" width="0.5" height="0.2" depth="0.1" color="#333333"></a-box>
        </a-entity>

        <!-- Skybox -->
        <a-sky color="#0c0c1e"></a-sky>
    </a-scene>

    <script>
        let score = 0;
        const totalObjects = 6;
        let gameCompleted = false;

        // Inicializimi i sistemit të rezultatit
        const scoreElement = document.getElementById('scoreValue');
        const progressBoxes = document.querySelectorAll('#progressBar a-box');

        // Event listener për çdo objekt interaktiv
        document.addEventListener('DOMContentLoaded', function() {
            const interactiveObjects = document.querySelectorAll('.interactive');
            
            interactiveObjects.forEach((obj, index) => {
                // Gaze-based interaction
                obj.addEventListener('fusing', function(evt) {
                    console.log('Fusing started on:', obj.id);
                });

                obj.addEventListener('click', function(evt) {
                    if (this.getAttribute('data-activated') === 'false') {
                        activateObject(this, index);
                    }
                });

                // Visual feedback për hover
                obj.addEventListener('mouseenter', function(evt) {
                    if (this.getAttribute('data-activated') === 'false') {
                        this.setAttribute('animation__hover', {
                            property: 'material.emissive',
                            to: '#444444',
                            dur: 200
                        });
                    }
                });

                obj.addEventListener('mouseleave', function(evt) {
                    if (this.getAttribute('data-activated') === 'false') {
                        this.setAttribute('animation__hover', {
                            property: 'material.emissive',
                            to: '#000000',
                            dur: 200
                        });
                    }
                });
            });
        });

        function activateObject(object, index) {
            // Shëno objektin si të aktivizuar
            object.setAttribute('data-activated', 'true');
            
            // Ndryshimi i materialit për të treguar aktivizimin
            object.setAttribute('material', 'emissive', '#00ff00');
            object.setAttribute('material', 'emissiveIntensity', '0.3');
            
            // Animacioni i aktivizimit
            object.setAttribute('animation__activate', {
                property: 'scale',
                to: '1.3 1.3 1.3',
                dur: 300,
                direction: 'alternate',
                loop: 1,
                easing: 'easeInOutBack'
            });

            // Përditësimi i rezultatit
            score++;
            scoreElement.textContent = score;
            
            // Përditësimi i progress bar
            if (progressBoxes[index]) {
                progressBoxes[index].setAttribute('color', '#00ff00');
                progressBoxes[index].setAttribute('animation__progress', {
                    property: 'material.emissive',
                    to: '#006600',
                    dur: 500
                });
            }

            // Kontrolli nëse loja është kompletuar
            if (score === totalObjects && !gameCompleted) {
                gameCompleted = true;
                setTimeout(() => {
                    completionCelebration();
                }, 500);
            }

            console.log(`Objekti ${object.id} u aktivizua! Rezultati: ${score}/${totalObjects}`);
        }

        function completionCelebration() {
            // Teksti i përfundimit
            const scene = document.querySelector('a-scene');
            const congratsText = document.createElement('a-text');
            
            congratsText.setAttribute('value', 'Urime! Të gjitha objektet u aktivizuan!');
            congratsText.setAttribute('position', '0 2.5 -1');
            congratsText.setAttribute('align', 'center');
            congratsText.setAttribute('color', '#00ff00');
            congratsText.setAttribute('width', '8');
            congratsText.setAttribute('animation__appear', {
                property: 'scale',
                from: '0 0 0',
                to: '1 1 1',
                dur: 1000,
                easing: 'easeOutElastic'
            });
            
            scene.appendChild(congratsText);

            // Efekti i fishekzjarrëve (particuj të thjeshtë)
            createFireworks();
        }

        function createFireworks() {
            const scene = document.querySelector('a-scene');
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57'];
            
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const firework = document.createElement('a-sphere');
                    firework.setAttribute('radius', '0.05');
                    firework.setAttribute('color', colors[Math.floor(Math.random() * colors.length)]);
                    
                    const startPos = `${(Math.random() - 0.5) * 8} 1 ${(Math.random() - 0.5) * 4}`;
                    const endPos = `${(Math.random() - 0.5) * 12} ${Math.random() * 4 + 2} ${(Math.random() - 0.5) * 6}`;
                    
                    firework.setAttribute('position', startPos);
                    firework.setAttribute('animation__fly', {
                        property: 'position',
                        to: endPos,
                        dur: 2000,
                        easing: 'easeOutQuad'
                    });
                    firework.setAttribute('animation__fade', {
                        property: 'material.opacity',
                        from: 1,
                        to: 0,
                        dur: 2000,
                        delay: 1000
                    });
                    
                    scene.appendChild(firework);
                    
                    // Largimi i objektit pas animacionit
                    setTimeout(() => {
                        if (firework.parentNode) {
                            firework.parentNode.removeChild(firework);
                        }
                    }, 3000);
                }, i * 100);
            }
        }
    </script>
</body>
</html>